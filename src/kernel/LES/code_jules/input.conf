! Input file
! 
! All lines beginning with '!' are comments All entries 
! are not case sensitive. Data blocks must begin with 
! '{' and end with '}'; the block name must be on the 
! same line as the entry bracket '{'.
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! Input file for the stable case, GABLS-1: See Beare et al. (2006)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  
! Domain parameters
DOMAIN {

  Nx = 256
  Ny = 160
  ! Total grid size (stored as nz_tot)
  Nz = 96

  ! Dimensional length scale [m]:
  z_i = 1000.0

  ! Grid stretching
  grid_stretch = .false.

  ! Grid size in the uniform portion of the domain
  ! Used only if grid_stretch=.true.
  grid_size = 5.0 

  ! Non-dimensional domain length (400^3 domain) 
  Lx = 7.680
  Ly = 3.200
  Lz = 1.152
}

! Model parameters
MODEL {

  ! Model type: 1->Smagorinsky; 5-> Lagragian scale-dep
  sgs_model = 4  

  ! Wall damping exponent for Mason model (default 2)
  wall_damp_exp = 2

  ! Timesteps between dynamic Cs updates
  cs_count = 5 

  ! Clipping constant to be used in Lagrangian model
  clip = 0.125

  ! Co used in the Mason model for Smagorisky coefficient
  Co = 0.16
}

CORIOLIS{

  !Neutral test case: Neutral BL
  neutral_ekman_test = .false.

  !coriolis_forcing = .true. activates the coriolis forces
  !mean_p_force has to be turned off if this is activated
  coriolis_forcing = .false.

  !Coriolis parameter: in rad/s
  coriol = 1.159e-4
  !Coriolis parameter for horizontal components: in rad/s
  coriol_x = 0.0
  coriol_y = 0.0 

  !Geostrophic velocities in (m/s)
  ug = 12.0
  vg = 0.0

  !Initial wind angle or the required wind_angle at the hub height
  !Only used if the wind angle controller is turned on
  wind_angle = 0.0

  !Height at which the wind angle is fixed (in m)
  z_wind = 90.000

  !Determines if the geostrophic wind direction has to be adjusted
  adjust_wind_angle = .true.

  !PID controller constants for wind angle controller
  Kpw = 25.e-3
  Kiw = 1.e-6
  Kdw = 0.0
}

! Baroclinicity parameters
BAROCLINIC{
  
  !Total velocity difference over shear layer in both directions [m/s].
  ug_delta = 0.0
  vg_delta = 0.0

  !Starting and ending height of layer [m].
  bar_start = 0.0
  bar_end = 1000.0

  !Turn on / off temperature advection term. 
  !Only use with with CNBL, or SBL with surface flux (not cooling rate!)
  temp_adv = .false.
}

! Scalar parameters
SCALAR {
  !GABLS1 test case run: Stable BL
  gabls_test = .true.

  !Sullivan test case: Unstable BL
  sullivan_test = .false.

  !Sullivan test case: Unstable BL
   neutral_test = .false.

  !MANUAL test case: define your own below. (not yet LVLSET-compatible)
   manual_test = .false.

  !MANUAL: inversion/stratification variables in m, K/m, m, K/m.
   cap_height = 1000.0
   cap_strength = 0.015
   strat_height = 1200.0
   strat_strength = 0.005
  
  !MANUAL: surface BC.
  !0= neutral. 1= constant heating(/cooling) rate (K/h). 2= constant heat flux (Km/s).
   surface_cond = 0
   surface_rate = -0.25
   surface_flux = -0.005

  !Prandtl number : Only used with Smagorinsky model
   Pr = 0.33

  !Roughness for scalar (non-dimensionalize by z_i) 
   zo_scalar = 2.e-7

   !inverstion-strength (K/m)
   inv_strength = -0.005
 
   !Scaling temperature in K
   T_scale = 286.0

   !Surface temperature: This is used in roughness_patch.f90
   !This will be useful in surface heterogeneity studies
   theta_s1 = 286.0

   !Surface flux: Km/s
   wt_s = 0.0

   !Cooling rate: K/h
   cooling_rate = 0.00

   !T_init in K
   T_init = 286.0

   !HBC: heat/thermal boundary condition
   ! hbc=0: Constant potential temperature
   ! hbc=1: Changing potential temperature (flux or cooling_rate)
   hbc = 1

   !UBC: upper boundary condition used for switching on damping_layer
    ubc = 1 

   !Damping method => 1. Klemp and Lilly damping 2. Rayleigh Damping
    damping_method = 2

    !Adds Rayeligh damping in the horizontal direction
    !Essentially removes all perturbations (wave and turbulence) in the x-direction
    damping_x = .false.

    !Damping factor
    dmpfr = 4.0

    !Damping height start (Domain height in (m)/z_i) 
    damp_hgt = 0.75 

    !Rayleigh damping factor
    ra_damp_exponent = 2.0

    !PID controller: To control the growth of the BL
    temp_sink = .false.

    !Min height at which the PID controller has to be applied
    !Boundary layer growth is limited to this height
    z_heat_min = 300.0

    !Max height at which the PID controller is applied
    z_heat_max = 400.0

    !Time at which the PID controller has to start
    !This is done to achieve statistical stationarity in otherwise unstable simulations
    time_heat = 4.0
 
    !Controller constants for the heat source/sink
    Cp = 10.0
    Ci = 1.0
    Cd = 0.0
}

TIME {

  ! Number of time steps to run simulation
  nsteps = 1000000000 

  ! Specify the allowed runtime in seconds; simulation will exit if exceeded.
  ! This will only account for time loop, not initialization or finalization.
  ! To disable set < 0
  runtime = 85000

  ! Specify CFL based dynamic time stepping (.true.)
  use_cfl_dt = .true.
  ! only used if use_cfl_dt=.true.
  cfl = 0.08

  ! Set static time step
  ! only used if use_cfl_dt=.false.
  dt = 1.e-4

}

! Output parameters
FLOW_COND {

  ! initu = true to read from a file; false create new initial condition 
  initu = .true.
  ! only used if initu=.false.
  initu_interp = .false.

  ! Lower boundary condition:  0 - stress free, 1 - wall
  ! NOTE: the upper boundary condition is stress free
  lbc_mom = 1

  ! Lower boundary condition, roughness length (0.1 m, non-dimensional)
  zo = 2.0e-6

  ! Use forced inflow
  inflow = .false.
  ! Use symmetric fringe? (Note: fringe_region_len should be increased
  ! when using a symmetric fringe, e.g. to 0.2)
  symmetric_fringe = .false.
  fringe_factor = 30.0
 
  ! If inflow is true the following should be set:
  ! position of right end of fringe region, as a fraction of L_x
  fringe_region_end = 1.0
  ! length of fringe region as a fraction of L_x
  fringe_region_len = 0.1
  ! position of right end of fringe region, as a fraction of L_y
  fringe_region_end_y = 1.0
  ! length of fringe region as a fraction of L_x
  fringe_region_len_y = 0.1
  ! Specify uniform inflow velocity (only used if USE_CPS=no in Makefile.in)
  inflow_velocity = 1.0

  ! Use mean pressure forcing
  use_mean_p_force = .true.
  u_star = 0.33
}

! Solver parameters
OUTPUT {
  
  ! Specify how often to display simulation update
  wbase = 100

  ! Turn on checkpointing restart data at intermediate time steps
  checkpoint_data = .true.
  ! Number of time steps to skip between checkpoints
  checkpoint_nskip = 100000 

  ! Turn on time averaging
  ! records time-averaged data to files ./output/*_avg.dat
  tavg_calc = .true.
  ! Set number of iterations to skip between samples
  tavg_nskip = 10
  ! Set the time average start time
  tavg_start_time = 28.8
  ! Set the time average end time
  tavg_end_time = 39.6

  ! Turn on instantaneous recording in entire domain
  domain_calc = .false.
  
  ! For 2D snapshots: itype==2. For 3D snapshots: itype == 3
  itype = 2

  ! Set when to start recording
  domain_nstart = 500000
  ! Set number of iterations to skip between recordings
  domain_nskip = 100

  !Bins for histogram of the velocities (io.f90)
  nbins   =  150
  bin_min_u = 5.
  bin_max_u = 35.
  bin_min_v = -25.
  bin_max_v = 25.
  bin_min_w = -25.
  bin_max_w = 25.
}

TURBINES {

  ! Number of turbine locations to be read from file
  nloc = 4

  ! Are turbines allowed to turn?
  dyn_theta1 = .true.

  ! filter size as a multiple of the grid spacing (for indicator funct.)
  ! ifilter_cufoff: only include indicator values above this threshold
  filter_size = 1.3

  !Time filter for rotatig turbine heads in seconds
  T_avg = 480

  filter_cutoff = 1e-2

  ! The number of timesteps between the output for the turbines
  tbase = 20
}

ADMR {
  ! number of turbines
  nturb = 1

  ! Epsilon for gaussian smearing function (will be multiplied by dx_dim)
  eps_kernel = 1.1
  ! projection radius (will be multiplied by dx_dim)
  pro_radius = 2.5

  ! The number of timesteps between the output data for ADM-R results
  admr_tbase = 20

  ! Are turbine heads allowed to turn? - NOT VERIFIED YET!!
  adjust_yaw = .false.

  !Time filter for rotatig turbine heads in seconds
  T_avg_admr  = 480
}

WINDBREAKS{
  ! Number of windbreak locations to be read from file
  nloc_wb = 0

  ! the filter size as a multiple of the grid spacing (used for indicator function)
  ! ifilter_cufoff: only include indicator values above this threshold
  filter_size_wb   = 1.3
  filter_cutoff_wb = 1e-2
}

LEVEL_SET {

  ! Surface roughness used for level_set surfaces (non-dimensional)
  zo_level_set = 6.06e-4

  ! Wall level on the w-grid, this is used for flat terrain case only
  zwall = 0.0

  ! phi_cutoff = dz*coeff_phi_cutoff is the position above wall surface,
  ! where the velocity is obtained by trilinear interpolation.
  coeff_phi_cutoff = 1.0

  ! phi_band = dz*coeff_phi_band is the width of fluid/solid band region
  coeff_phi_band = 1.0
}
